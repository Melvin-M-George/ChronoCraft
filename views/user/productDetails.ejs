


<%-include("../partials/user/header")%>

<style>
    .product-extra-link2 {
    display: flex;
    justify-content: center; 
    align-items: center;    
    gap: 15px;               
    margin-top: 20px;
}

.button-add-to-cart {
    display: inline-block;
    padding: 10px 20px;
    font-size: 16px;
    font-weight: 600;
    color: #ffffff;
    background-color: #424874; 
    border: none;
    border-radius: 5px;
    text-transform: uppercase;
    transition: background-color 0.3s ease, transform 0.3s ease;
    cursor: pointer;
    text-align: center;
}

.button-add-to-cart:hover {
    background-color: #A6B1E1; 
    transform: scale(1.05);
}

#products-container {
    display: grid;
    grid-template-columns: repeat(4, 1fr); /* Four equal-width columns */
    gap: 20px; /* Space between the cards */
}

.product-cart-wrap {
    width: 100%; /* Ensure the card uses the full allocated column space */
    box-sizing: border-box; /* Include padding/border in the card size */
}

    h1 {
        text-align: left; /* Align the heading to the left */
        font-size: 2rem; /* Adjust font size */
        color: #424874; /* Set a matching color */
        font-weight: bold; /* Make it bold */
        margin-bottom: 20px; /* Add space below the heading */
        text-transform: uppercase; /* Make the text uppercase */
        letter-spacing: 2px; /* Add spacing between letters */
        border-bottom: 2px solid #ddd; /* Add an underline */
        padding-bottom: 10px; /* Add spacing above the underline */
        width: fit-content; /* Keep underline width fitting text */
    }



</style>


<main class="main">
    <div class="page-header breadcrumb-wrap">
        <div class="container">
            <div class="breadcrumb">
                <a href="/" rel="nofollow">Home</a>
                <span></span> Products
                <span></span> Product Details
            </div>
        </div>
    </div>
    <section class="mt-50 mb-50">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <div class="product-detail accordion-detail">

                        
                        <div class="row mb-50">
                            <div class="col-md-6 col-sm-12 col-xs-12">
                                <div class="detail-gallery">
                                    <span class="zoom-icon"><i class="fi-rs-search"></i></span>
                                    <div class="product-image-slider">
                                        <% for(let i=0; i<data.productImages.length; i++){ %>
                                        <figure class="border-radius-10">
                                            <img src="/uploads/re-image/<%=data.productImages[i] %>" alt="product image">
                                        </figure>
                                        <% } %>
                                    </div>
                                    <div class="slider-nav-thumbnails pl-15 pr-15">
                                        <% for(let i=0; i<data.productImages.length; i++){ %>
                                        <div><img src="uploads/re-image/<%=data.productImages[i]%>" alt="product image"></div>
                                        <% } %>
                                    </div>
                                </div>
                            </div>
                        
                            <div class="col-md-6 col-sm-12 col-xs-12">
                                <div class="detail-info">
                                    <h2 class="title-detail"><%=data.productName %></h2>
                                    <div class="product-detail-rating">
                                        <div class="pro-details-brand">
                                            <span>Brand: <a href="shop-grid-right.html"><%=data.brand %></a></span>
                                        </div>
                                        <div class="product-rate-cover text-end">
                                            <div class="product-rate d-inline-block">
                                                <div class="product-rating" style="width:90%"></div>
                                            </div>
                                            <span class="font-small ml-5 text-muted">(25 reviews)</span>
                                        </div>
                                    </div>
                                    <div class="clearfix product-price-cover">
                                        <div class="product-price primary-color float-left">
                                            <ins><span class="text-brand">₹<%=data.salePrice %></span></ins>
                                            <ins><span class="old-price font-md ml-15">₹<%=data.regularPrice %></span></ins>
                                        </div>
                                    </div>
                                    <div class="bt-1 border-color-1 mt-15 mb-15"></div>
                                    <div class="short-desc mb-30">
                                        <p><%=data.description %></p>
                                    </div>
                                    <div class="product_sort_info font-xs mb-30">
                                        <ul>
                                            <li class="mb-10"><i class="fi-rs-crown mr-5"></i> 2 Year <%=data.brand%> Brand Warranty</li>
                                            <li class="mb-10"><i class="fi-rs-refresh mr-5"></i> 30 Day Return Policy</li>
                                            <li><i class="fi-rs-credit-card mr-5"></i> Cash on Delivery available</li>
                                        </ul>
                                    </div>
                                    <div class="bt-1 border-color-1 mt-30 mb-30"></div>
                        
                                    
                                    <% if (data.quantity > 0) { %>
                                    <!-- Display Quantity Selector and Buttons -->
                                    <div class="detail-extralink" style="display: flex; flex-direction: column; align-items: center; gap: 10px;">
                                        <div class="detail-qty" style="display: flex; align-items: center; gap: 10px;">
                                            <input type="text" name="quantity" value="1" class="qty-val" id="qty-val" 
                                                readonly 
                                                style="width: 50px; text-align: center; font-size: 16px; border: 1px solid #ccc; border-radius: 5px; padding: 5px;">
                                            <div class="qty-controls" style="display: flex; flex-direction: column; gap: 5px;">
                                                <button type="button" class="qty-up" onclick="updateQuantity(1)" 
                                                    style="background: none; border: none; cursor: pointer; padding: 5px;">
                                                    <i class="fi-rs-angle-small-up" style="font-size: 20px;"></i>
                                                </button>
                                                <button type="button" class="qty-down" onclick="updateQuantity(-1)" 
                                                    style="background: none; border: none; cursor: pointer; padding: 5px;">
                                                    <i class="fi-rs-angle-small-down" style="font-size: 20px;"></i>
                                                </button>
                                            </div>
                                        </div>
                                        <div class="product-extra-link2">
                                            <a style="width: 200px;" type="submit" class="button button-add-to-cart" onclick="addToCart('<%= data._id %>')">
                                                Add to Cart
                                            </a>                                            
                                            <a aria-label="Add To Wishlist" class="action-btn hover-up" onclick="addToWishlist('<%= data._id %>')">
                                                <i class="fi-rs-heart"></i>
                                            </a>
                                            
                                            <a style="width: 200px;" type="submit" class="button button-add-to-cart"
                                                onclick="redirectToCheckout('<%= data._id %>')">
                                                Buy Now
                                                </a>

                                        </div>
                                    </div>
                                    <% } else { %>



                                    <!-- Display Out of Stock Message -->
                                    <div class="product-extra-link2">
                                        <h5 class="text-danger">Out of Stock</h5>
                                    </div>
                                    <% } %>
                        
                                    <ul class="product-meta font-xs color-grey mt-50">
                                        <li class="mb-5">Category: <a href="#" rel="tag"><%= data.category.name %></a></li>
                                        <li>Availability:<span class="in-stock text-success ml-5"><%=data.quantity %> Items In Stock</span></li>
                                    </ul>
                                </div>
                            </div>
                        </div>


                        
                        <h1>You May Also Like</h1>
                        <div class="tab-content wow fadeIn animated" id="myTabContent">
                            <div class="tab-pane fade show active" id="tab-one" role="tabpanel" aria-labelledby="tab-one">
        
                                <div class="row product-grid-4" id="products-container">
                                    <% for (let i = 0; i < products.length; i++) { %>
                                        <div class="product-cart-wrap mb-30" 
                                             style="flex: 1 1 23%; box-sizing: border-box; margin: 10px; background-color: #ffffff; border-radius: 10px; padding: 15px; box-shadow: 0 4px 6px #424874;">
                                            <div class="product-img-action-wrap">
                                                <div class="product-img product-img-zoom">
                                                    <a href="/productDetails?id=<%= products[i]._id %>">
                                                        <% if (products[i].productImages && products[i].productImages.length > 0) { %>
                                                            <img class="default-img" src="/uploads/re-image/<%= products[i].productImages[0] %>" alt="<%= products[i].productName %>">
                                                        <% } %> 
                                                    </a>
                                                </div>
                                            </div>
                                            <br>
                                            <div class="product-content-wrap">
                                                <h6><%= products[i].productName %></h6>
                                                <br>
                                                <h6>₹ <%= products[i].salePrice.toLocaleString() %></h6>
                                                <br>
                                                <% if (products[i].quantity > 0) { %>
                                                    <h6 style="color:green">Stock: <%= products[i].quantity %></h6>
                                                <% } else { %>
                                                    <h6 style="color:red">Out of Stock</h6>
                                                <% } %>
                                            </div>
                                            <% if (products[i].quantity > 0) { %>
                                                <div class="product-action-1 show">
                                                    <a aria-label="Add To Cart" class="action-btn hover-up" onclick="addToCart('<%= products[i]._id %>')">
                                                        <i class="fi-rs-shopping-bag-add"></i>
                                                    </a>
                                                    <a aria-label="Add To Wishlist" class="action-btn hover-up" onclick="addToWishlist('<%= products[i]._id %>')">
                                                        <i class="fi-rs-heart"></i>
                                                    </a>
                                                </div>
                                            <% } else { %>
                                                <div class="product-action-1 show">
                                                    <span class="text-muted">Unavailable</span>
                                                </div>
                                            <% } %>
                                        </div>
                                    <% } %>
                                </div>
                                
                            </div>
                        </div>
                        
                            
                        
                        <div class="row">
                            
                                <h3 class="section-title style-1 mb-30 mt-30">Reviews (3)</h3>
                                
                                <div class="comments-area style-2">
                                    <div class="row">
                                        <div class="col-lg-8">
                                            <h4 class="mb-30">Customer questions & answers</h4>
                                            <div class="comment-list">
                                                <div class="single-comment justify-content-between d-flex">
                                                    <div class="user justify-content-between d-flex">
                                                        <div class="thumb text-center">
                                                            <img src="assets/imgs/page/avatar-6.jpg" alt="">
                                                            <h6><a href="#">Jacky Chan</a></h6>
                                                            <p class="font-xxs">Since 2012</p>
                                                        </div>
                                                        <div class="desc">
                                                            <div class="product-rate d-inline-block">
                                                                <div class="product-rating" style="width:90%">
                                                                </div>
                                                            </div>
                                                            <p>Thank you very fast shipping from Poland only 3days.</p>
                                                            <div class="d-flex justify-content-between">
                                                                <div class="d-flex align-items-center">
                                                                    <p class="font-xs mr-30">December 4, 2020 at 3:12 pm </p>
                                                                    <a href="#" class="text-brand btn-reply">Reply <i class="fi-rs-arrow-right"></i> </a>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                
                                                <div class="single-comment justify-content-between d-flex">
                                                    <div class="user justify-content-between d-flex">
                                                        <div class="thumb text-center">
                                                            <img src="assets/imgs/page/avatar-7.jpg" alt="">
                                                            <h6><a href="#">Ana Rosie</a></h6>
                                                            <p class="font-xxs">Since 2008</p>
                                                        </div>
                                                        <div class="desc">
                                                            <div class="product-rate d-inline-block">
                                                                <div class="product-rating" style="width:90%">
                                                                </div>
                                                            </div>
                                                            <p>Great low price and works well.</p>
                                                            <div class="d-flex justify-content-between">
                                                                <div class="d-flex align-items-center">
                                                                    <p class="font-xs mr-30">December 4, 2020 at 3:12 pm </p>
                                                                    <a href="#" class="text-brand btn-reply">Reply <i class="fi-rs-arrow-right"></i> </a>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                
                                                <div class="single-comment justify-content-between d-flex">
                                                    <div class="user justify-content-between d-flex">
                                                        <div class="thumb text-center">
                                                            <img src="assets/imgs/page/avatar-8.jpg" alt="">
                                                            <h6><a href="#">Steven Keny</a></h6>
                                                            <p class="font-xxs">Since 2010</p>
                                                        </div>
                                                        <div class="desc">
                                                            <div class="product-rate d-inline-block">
                                                                <div class="product-rating" style="width:90%">
                                                                </div>
                                                            </div>
                                                            <p>Authentic and Beautiful, Love these way more than ever expected They are Great earphones</p>
                                                            <div class="d-flex justify-content-between">
                                                                <div class="d-flex align-items-center">
                                                                    <p class="font-xs mr-30">December 4, 2020 at 3:12 pm </p>
                                                                    <a href="#" class="text-brand btn-reply">Reply <i class="fi-rs-arrow-right"></i> </a>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                
                                            </div>
                                        </div>
                                        <div class="col-lg-4">
                                            <h4 class="mb-30">Customer reviews</h4>
                                            <div class="d-flex mb-30">
                                                <div class="product-rate d-inline-block mr-15">
                                                    <div class="product-rating" style="width:90%">
                                                    </div>
                                                </div>
                                                <h6>4.8 out of 5</h6>
                                            </div>
                                            <div class="progress">
                                                <span>5 star</span>
                                                <div class="progress-bar" role="progressbar" style="width: 50%;" aria-valuenow="50" aria-valuemin="0" aria-valuemax="100">50%</div>
                                            </div>
                                            <div class="progress">
                                                <span>4 star</span>
                                                <div class="progress-bar" role="progressbar" style="width: 25%;" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100">25%</div>
                                            </div>
                                            <div class="progress">
                                                <span>3 star</span>
                                                <div class="progress-bar" role="progressbar" style="width: 45%;" aria-valuenow="45" aria-valuemin="0" aria-valuemax="100">45%</div>
                                            </div>
                                            <div class="progress">
                                                <span>2 star</span>
                                                <div class="progress-bar" role="progressbar" style="width: 65%;" aria-valuenow="65" aria-valuemin="0" aria-valuemax="100">65%</div>
                                            </div>
                                            <div class="progress mb-30">
                                                <span>1 star</span>
                                                <div class="progress-bar" role="progressbar" style="width: 85%;" aria-valuenow="85" aria-valuemin="0" aria-valuemax="100">85%</div>
                                            </div>
                                            <a href="#" class="font-xs text-muted">How are ratings calculated?</a>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="comment-form">
                                    <h4 class="mb-15">Add a review</h4>
                                    <div class="product-rate d-inline-block mb-30">
                                    </div>
                                    <div class="row">
                                        <div class="col-lg-8 col-md-12">
                                            <form class="form-contact comment_form" action="#" id="commentForm">
                                                <div class="row">
                                                    <div class="col-12">
                                                        <div class="form-group">
                                                            <textarea class="form-control w-100" name="comment" id="comment" cols="30" rows="9" placeholder="Write Comment"></textarea>
                                                        </div>
                                                    </div>
                                                    <div class="col-sm-6">
                                                        <div class="form-group">
                                                            <input class="form-control" name="name" id="name" type="text" placeholder="Name">
                                                        </div>
                                                    </div>
                                                    <div class="col-sm-6">
                                                        <div class="form-group">
                                                            <input class="form-control" name="email" id="email" type="email" placeholder="Email">
                                                        </div>
                                                    </div>
                                                    <div class="col-12">
                                                        <div class="form-group">
                                                            <input class="form-control" name="website" id="website" type="text" placeholder="Website">
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <button type="submit" class="button button-contactForm">Submit
                                                        Review</button>
                                                </div>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                       
                    </div>
                </div>
            </div>
        </div>
    </section>
</main>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>



<script>


function redirectToCheckout(productId) {
            const qtyValue = document.getElementById('qty-val').value;
            window.location.href = `/checkout?productId=${productId}&qty=${qtyValue}`;
        }


        async function updateCounts() {
    try {
        const response = await fetch('/headerBadgeCount');
        const data = await response.json();

        if (data.success) {
            // Update the badge counts
            document.getElementById('cart-count').textContent = data.cartlen;
            document.getElementById('wishlist-count').textContent = data.wishlistlen;
        } else {
            console.error("Failed to fetch counts:", data.message);
        }
    } catch (error) {
        console.error("Error fetching counts:", error);
    }
}

async function addToCart(productId) {
    const qtyInput = document.getElementById('qty-val'); // Get the quantity input value
    const quantity = parseInt(qtyInput.value);

    try {
        const response = await fetch(`/addToCart?id=${productId}`, {
            method: "POST",
            headers: {
                "Content-Type": "application/json", // Set the content type to JSON
            },
            body: JSON.stringify({ quantity }), // Send the quantity in the request body
        });

        const data = await response.json();

        if (data.success) {
            Swal.fire({
                icon: "success",
                title: "Success!",
                text: data.message,
                showConfirmButton: false,
                toast: true,
                position: "top-end",
                timer: 1500,
                timerProgressBar: true,
            }).then(() => {
                updateCounts(); // Update counts after adding to cart
            });
        } else {
            Swal.fire({
                icon: "warning",
                title: "Limit Reached",
                text: data.message,
                toast: true,
                position: "top-end",
                timer: 1500,
                timerProgressBar: true,
            });
        }
    } catch (error) {
        Swal.fire({
            icon: "error",
            title: "Error!",
            text: "An unexpected error occurred",
            toast: true,
            position: "top-end",
            timer: 1500,
            timerProgressBar: true,
        });
        console.error("Error:", error);
    }
}


async function addToWishlist(productId) {
    try {
        const response = await fetch(`/addToWishlist?id=${productId}`, { method: "GET" });
        const data = await response.json();

        if (data.success) {
            Swal.fire({
                icon: "success",
                title: "Success!",
                text: data.message,
                showConfirmButton: false,
                toast: true,
                position: "top-end",
                timer: 1500,
                timerProgressBar: true,
            }).then(() => {
                updateCounts(); // Update counts after adding to wishlist
            });
        } else {
            Swal.fire({
                toast: true,
                position: "top-end",
                timer: 1500,
                timerProgressBar: true,
                icon: "error",
                title: "Oops!",
                text: data.message
            });
        }
    } catch (error) {
        Swal.fire({
            toast: true,
            position: "top-end",
            timer: 1500,
            timerProgressBar: true,
            icon: "error",
            title: "Error!",
            text: "An unexpected error occurred"
        });
        console.error("Error:", error);
    }
}


</script>
<script>
   const maxQuantity = '<%= data.quantity %>'; 
const maxLimit = 5;  
function updateQuantity(change) {
    const qtyInput = document.getElementById('qty-val');
    let currentQty = parseInt(qtyInput.value);

   
    if (maxQuantity < maxLimit && currentQty >= maxQuantity && change > 0) {
        Swal.fire({
            title: 'Insufficient Stock!',
            text: `We only have ${maxQuantity} items in stock. You can't add more.`,
            icon: 'warning',
            confirmButtonText: 'OK'
        });
        return;
    }

    
    if (currentQty >= maxLimit && change > 0) {
        Swal.fire({
            title: 'Maximum Limit Reached!',
            text: `You can only add up to ${maxLimit} items.`,
            icon: 'warning',
            confirmButtonText: 'OK'
        });
        return;
    }

    
    currentQty = Math.max(1, Math.min(maxQuantity, currentQty + change));
    qtyInput.value = currentQty;
}


</script>



<%-include("../partials/user/footer")%>